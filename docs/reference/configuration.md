# Configuration

The recommended way to configure jj-spr is to run `jj-spr init`, rather than setting config values manually. You can rerun `jj-spr init` to update config at any time.

## Configuration Storage

jj-spr stores its configuration in Jujutsu's config system, which can be set at multiple levels:
- Repository-specific: `.jj/repo/config.toml`
- User-specific: `~/.jjconfig.toml`
- System-wide: `/etc/jj/config.toml`

## Configuration Values

jj-spr uses the following configuration values:

| config key           | CLI flag                          | description                                                                         | default[^default] | default in `jj-spr init`[^initdefault]        |
| -------------------- | --------------------------------- | ----------------------------------------------------------------------------------- | ----------------- | --------------------------------------------- |
| `githubAuthToken`    | `--github-auth-token`[^cli-token] | The GitHub PAT (personal authentication token) to use for accessing the GitHub API. |                   |                                               |
| `githubRemoteName`   |                                   | Name of the git remote in this local repository that corresponds to GitHub          | `origin`          | `origin`                                      |
| `githubRepository`   | `--github-repository`             | Name of repository on github.com in `owner/repo` format                             |                   | extracted from the URL of the GitHub remote   |
| `githubMasterBranch` |                                   | The name of the centrally shared branch into which the pull requests are merged     | `main`            | taken from repository configuration on GitHub |
| `branchPrefix`       | `--branch-prefix`                 | String used to prefix autogenerated names of pull request branches                  |                   | `jj-spr/GITHUB_USERNAME/`                     |
| `requireApproval`    |                                   | If true, `jj-spr land` will refuse to land a pull request that is not approved     | false             | true                                          |
| `requireTestPlan`    |                                   | If true, `jj-spr diff` will refuse to process a commit without a test plan         | true              | true                                          |

Notes:
- All config keys are in the `spr` section; for example, `spr.githubAuthToken`.
- Values passed on the command line take precedence over values set in configuration.
- `jj-spr init` writes configured values into `.jj/repo/config.toml` in the local repo.

## Setting Configuration

### Using jj-spr init (recommended)
```shell
jj-spr init
```

### Using jj config set
```shell
# Set repository-specific config
jj config set --repo spr.githubAuthToken "your-token"
jj config set --repo spr.requireTestPlan false

# Set user-specific config
jj config set --user spr.branchPrefix "my-prefix/"
```

### Editing config files directly

Repository config in `.jj/repo/config.toml`:
```toml
[spr]
githubAuthToken = "ghp_..."
githubRepository = "owner/repo"
githubRemoteName = "origin"
githubMasterBranch = "main"
branchPrefix = "jj-spr/username/"
requireApproval = true
requireTestPlan = true
```

## Jujutsu-Specific Configuration

In addition to jj-spr settings, you may want to configure Jujutsu itself for optimal workflow:

```toml
# Recommended Jujutsu settings for jj-spr workflow
[ui]
default-command = "log"
pager = "less -FRX"

[git]
# Prefix for branches pushed to GitHub
push-branch-prefix = "jj-spr/"

[revset-aliases]
# Useful revsets for jj-spr workflow
'mine' = 'author(exact:"your.email@example.com")'
'ready' = 'mine & description(regex:"^(?!wip:)")'
'has-pr' = 'mine & description(regex:"Pull Request:")'

[templates]
# Custom log format showing PR numbers
'log' = '''
label(if(current_working_copy, "bold"),
  concat(
    separate(" ",
      label("cyan", change_id.shortest(8)),
      label("magenta", if(description, description.first_line(), "(no description)"))
    ),
    if(description.regex("Pull Request: .*(#\\d+)"), 
      label("green", " " ++ description.regex("Pull Request: .*(#\\d+)")))
  )
)
'''
```

## Environment Variables

jj-spr also respects certain environment variables:

- `GITHUB_TOKEN`: Can be used instead of configuring `githubAuthToken`
- `JJ_SPR_BRANCH_PREFIX`: Override for `branchPrefix` config

[^default]: Value used by `jj-spr` if not set in configuration.
[^initdefault]: Value suggested by `jj-spr init` if not previously configured.
[^cli-token]: Be careful using this: your auth token will be in your shell history.